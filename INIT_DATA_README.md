# 测试数据初始化说明

## 概述

为了方便开发和测试，系统现在会在启动时自动初始化测试数据。这样即使重新部署，测试数据也会自动恢复。

## 初始化时机

每次系统启动时，会自动检查并创建以下测试数据：
- 默认管理员账户
- 默认系统设置
- 示例产品分类
- 示例产品数据（带图片）

## 初始化逻辑

### 智能初始化（不会重复创建）

系统会检查数据是否已存在，如果存在则跳过创建：

```python
# 示例产品创建
if Product.query.count() > 0:
    print("产品数据已存在，跳过创建")
    return
```

这意味着：
- **首次启动**：创建所有测试数据
- **后续启动**：跳过已存在的数据，快速启动
- **重新部署**：如果是新数据库，会重新创建测试数据

## 包含的测试数据

### 1. 默认管理员账户

| 字段 | 值 |
|------|-----|
| 用户名 | `admin` |
| 邮箱 | `admin@example.com` |
| 密码 | `admin123` |
| 角色 | `admin` |

### 2. 示例分类（5个）

1. **个人护理** - 牙膏、洗发水、沐浴露等
2. **清洁用品** - 洗衣液、洗洁精、清洁剂等
3. **纸品湿巾** - 卫生纸、抽纸、湿巾等
4. **厨房用品** - 保鲜膜、垃圾袋等
5. **家居纺织** - 毛巾、浴巾、床上用品等

### 3. 示例产品（10个）

| 货号 | 产品名称 | 零售价 | 批发价 | 批发最小数量 | 库存 |
|------|----------|--------|--------|--------------|------|
| SP001 | 牙膏-薄荷味 | ¥12.5 | ¥10.0 | 2 | 500 |
| SP002 | 洗发水-去屑型 | ¥38.0 | ¥32.0 | 3 | 200 |
| SP003 | 洗衣液-薰衣草 | ¥25.0 | ¥20.0 | 5 | 300 |
| SP004 | 毛巾-纯棉 | ¥8.5 | ¥7.0 | 10 | 600 |
| SP005 | 纸巾-抽纸-3层 | ¥12.0 | ¥10.0 | 2 | 500 |
| SP006 | 沐浴露-海洋香 | ¥45.0 | ¥38.0 | 3 | 150 |
| SP007 | 洗洁精-柠檬 | ¥18.0 | ¥15.0 | 5 | 400 |
| SP008 | 卫生纸-卷纸 | ¥28.0 | ¥24.0 | 3 | 350 |
| SP009 | 垃圾袋-大号 | ¥15.0 | ¥12.0 | 10 | 500 |
| SP010 | 护手霜-滋润型 | ¥22.0 | ¥18.0 | 5 | 250 |

### 4. 产品图片

所有示例产品都配置了占位图片：
- 路径：`/static/images/product-placeholder.jpg`
- 尺寸：400x400
- 每个产品都有1张主图

## 启动日志示例

```
============================================================
开始初始化示例数据...
============================================================
管理员账户已存在
示例分类已创建
产品数据已存在，跳过创建
============================================================
示例数据初始化完成！
============================================================
```

## 手动重新初始化

如果需要清空数据库并重新初始化测试数据，可以：

### 方法1：删除数据库文件（SQLite）

```bash
rm price_query.db
python app.py
```

### 方法2：清空表并重启（PostgreSQL）

```python
from app import create_app
from app.models import db

app = create_app()
with app.app_context():
    db.drop_all()
    db.create_all()
```

然后重启服务：
```bash
python app.py
```

## 注意事项

### 生产环境部署

在生产环境中，你可能想要：

1. **修改初始化逻辑**：在 `app/services/init_service.py` 中修改，使其只在开发环境初始化测试数据

```python
from flask import current_app

def init_sample_data():
    if current_app.config['ENV'] != 'development':
        print("生产环境，跳过测试数据初始化")
        return
    # ... 原有代码
```

2. **修改配置文件**：在 `config.py` 中设置 `ENV = 'production'`

### 数据持久化

- **SQLite 开发环境**：测试数据会持久化到 `price_query.db` 文件中
- **PostgreSQL 生产环境**：测试数据存储在数据库中，不会丢失
- **对象存储**：产品上传的图片会持久化到对象存储中

## 相关文件

- `app/services/init_service.py` - 测试数据初始化服务
- `app/__init__.py` - 应用初始化，调用测试数据服务
- `app/static/images/product-placeholder.jpg` - 产品占位图片
